identity_and_access_management:
  
  document_info:
    chapter: "3.1"
    title: "Identity and Access Management at Scale"
    version: "1.0.0"
    author: "Raghav Dinesh"
    github: "github.com/raghavpoonia"
    license: "MIT"
    classification: "Security Operating Manual"
    part: "Part III: Implementation"
    
    sections_in_this_document:
      - overview
      - core_principles
      - maturity_model
      - building_from_zero
      - iam_strategy
      - authentication_architecture
      - authorization_patterns
      - privilege_management
      - service_account_governance
      - zero_trust_identity
      - identity_federation
      - identity_lifecycle_management
      - identity_threat_detection
      
    core_principles_covered:
      - id: "IAM-P001"
        name: "Identity is the perimeter"
      - id: "IAM-P002"
        name: "Least privilege by default"
      - id: "IAM-P003"
        name: "Zero trust, always verify"
      - id: "IAM-P004"
        name: "Automate identity lifecycle"
      - id: "IAM-P005"
        name: "Ephemeral over persistent"
      - id: "IAM-P006"
        name: "Visibility enables security"
    
    how_to_use_this_chapter:
      step_1: "Read overview and core principles"
      step_2: "Complete IAM maturity self-assessment"
      step_3: "Jump to section matching your maturity level"
      step_4: "Cross-reference with Chapter 2.4 for identity threat detection"
  
  overview: |
    Identity and Access Management (IAM) is the foundation of modern security 
    architecture. In traditional perimeter-based security, the network boundary 
    defined trust. In cloud-native and remote-work environments, identity has 
    become the perimeter. Every access decision—to applications, data, infrastructure—
    depends on robust identity verification and authorization.
    
    This chapter addresses IAM at enterprise scale: managing thousands of users, 
    hundreds of thousands of service accounts, complex authorization policies, 
    and zero-trust identity architectures. IAM done right prevents the credential 
    compromise and privilege escalation that detection engineering (Chapter 2.4) 
    is designed to catch.
    
    Use the maturity model to assess current IAM capability and follow the 
    appropriate implementation path. This chapter serves organizations from 
    basic Active Directory deployments to sophisticated zero-trust identity 
    architectures with continuous authentication and risk-based access control.
    
  core_principles:
    
    identity_is_perimeter:
      id: "IAM-P001"
      maturity_level: "All levels"
      principle: "Identity is the new security perimeter, not network location"
      rationale: |
        Network perimeters are dead. Users work from home, coffee shops, airports. 
        Applications run in multiple clouds. Data exists everywhere. The only 
        constant is identity. Security decisions must be based on "who" and "what," 
        not "where." Identity verification and authorization determine access, 
        regardless of network location.
      implementation:
        - "Move from network-based trust to identity-based trust"
        - "Require authentication for all access, internal or external"
        - "Deploy SSO as single identity control point"
        - "Eliminate VPN as primary access control (replace with zero trust network access)"
      metrics:
        - "Percentage of applications integrated with SSO: Target >90%"
        - "Percentage of users using SSO vs local credentials: Target >95%"
        - "Legacy network-based access controls remaining: Target = 0"
      anti_patterns:
        - "Trusting users because they're on corporate network"
        - "Allowing direct access to internal apps without authentication"
        - "Using network location as sole authorization criterion"
        - "VPN as catch-all solution for remote access"
      example: |
        Organization allowed internal network access to assume trust. Attacker 
        compromised laptop on corporate WiFi, gained access to financial systems 
        without additional authentication. Moved to identity-based access: all 
        apps require SSO authentication regardless of network. Lateral movement 
        blocked even with compromised endpoint.
        
    least_privilege_default:
      id: "IAM-P002"
      maturity_level: "All levels"
      principle: "Grant minimum permissions required, deny by default"
      rationale: |
        Excessive permissions enable lateral movement, privilege escalation, and 
        data exfiltration. Users and services accumulate permissions over time 
        but rarely have them revoked. Least privilege limits blast radius when 
        credentials are compromised. Start with no access, grant only what's 
        required, review and revoke continuously.
      implementation:
        - "Default deny: No access unless explicitly granted"
        - "Time-bound permissions: Access expires and requires renewal"
        - "Just-in-time access: Elevate privileges only when needed, automatically revoke"
        - "Regular access reviews: Quarterly review and revoke unused permissions"
      metrics:
        - "Percentage of users with administrative privileges: Target <5%"
        - "Average permission lifetime before review: Target <90 days"
        - "Percentage of access grants that are time-bound: Target >80%"
        - "Permissions revoked per access review cycle: Track trend"
      anti_patterns:
        - "Granting admin rights for convenience"
        - "Never revoking permissions when role changes"
        - "Broad permissions to avoid access requests"
        - "Service accounts with owner/admin on everything"
      example: |
        Developer requested database access. Admin granted db_owner role for 
        convenience. Developer left company, account disabled but service account 
        they created retained db_owner. Attacker compromised service account, 
        full database access. Lesson: Grant db_datareader only, time-bound access, 
        service account inventory and cleanup.
        
    zero_trust_always_verify:
      id: "IAM-P003"
      maturity_level: "Level 2+"
      principle: "Never trust, always verify - continuous authentication and authorization"
      rationale: |
        Traditional security: Authenticate once at login, trust for session duration. 
        Zero trust: Continuously verify user, device, context before every access 
        decision. User authenticated 8 hours ago from trusted device might now be 
        attacker with stolen session token. Re-verify identity, device posture, 
        risk signals before granting access.
      implementation:
        - "Continuous authentication: Re-verify identity throughout session"
        - "Device trust: Verify device health and compliance before access"
        - "Context-aware access: Consider location, time, risk signals"
        - "Micro-segmentation: Verify for each resource, not just initial entry"
      metrics:
        - "Percentage of applications with continuous authentication: Target >70%"
        - "Device compliance enforcement rate: Target 100%"
        - "Context-based access denials per month: Track anomalies"
        - "Average session re-verification frequency: Target <4 hours"
      anti_patterns:
        - "Trust after initial login for entire day"
        - "Ignoring device posture in access decisions"
        - "Same access policy for all contexts (office vs airport WiFi)"
        - "No re-authentication for high-risk actions"
      example: |
        User authenticated to SSO at 9 AM from managed device. At 2 PM, attacker 
        stole session token, attempted access from unmanaged device in different 
        country. Continuous authentication detected device change and geographic 
        impossibility. Re-authentication required with MFA, access denied, incident 
        triggered. Session theft mitigated through continuous verification.
        
    automate_lifecycle:
      id: "IAM-P004"
      maturity_level: "Level 2+"
      principle: "Automate identity lifecycle from onboarding to offboarding"
      rationale: |
        Manual identity management doesn't scale and creates security gaps. New 
        employee waits days for access (productivity loss). Terminated employee 
        account stays active for weeks (security risk). Automation ensures timely, 
        consistent identity provisioning and deprovisioning. HR system becomes 
        source of truth, identity changes propagate automatically.
      implementation:
        - "Automate provisioning: HR hire event → accounts created, access granted"
        - "Automate deprovisioning: HR termination event → accounts disabled immediately"
        - "Automate role changes: Job change → permissions adjusted automatically"
        - "Automate access reviews: Quarterly attestation workflows"
      metrics:
        - "Time from hire to account provisioning: Target <4 hours"
        - "Time from termination to account disabling: Target <1 hour"
        - "Percentage of provisioning automated: Target >90%"
        - "Orphaned accounts (no HR record): Target = 0"
      anti_patterns:
        - "Manual account creation via IT tickets"
        - "Termination communicated via email, manual cleanup"
        - "Role changes require manual permission reviews"
        - "Annual access reviews via spreadsheets"
      example: |
        Employee terminated Friday afternoon. Manual process meant accounts disabled 
        Monday morning. Attacker used 60-hour window to exfiltrate data. Implemented 
        automated deprovisioning: HR termination in system triggers immediate account 
        disable across all platforms (AD, AWS, GCP, SaaS). Access revoked within 
        15 minutes regardless of day or time.
        
    ephemeral_over_persistent:
      id: "IAM-P005"
      maturity_level: "Level 3+"
      principle: "Prefer short-lived credentials over long-lived secrets"
      rationale: |
        Long-lived credentials (passwords, API keys, service account keys) are 
        theft targets and difficult to rotate. Once stolen, attacker has unlimited 
        time to use them. Short-lived credentials (OAuth tokens, temporary keys, 
        certificates) expire automatically, limiting attacker window. Credential 
        theft becomes less valuable when credentials expire in hours, not years.
      implementation:
        - "OAuth tokens with 1-hour expiration over API keys"
        - "Temporary cloud credentials (STS AssumeRole) over access keys"
        - "Short-lived certificates over long-lived passwords"
        - "Session tokens over persistent authentication"
      metrics:
        - "Percentage of service accounts using ephemeral credentials: Target >80%"
        - "Average credential lifetime: Target <24 hours for ephemeral"
        - "Long-lived credentials in use: Track and reduce monthly"
        - "Credential rotation frequency: Quarterly for any long-lived credentials"
      anti_patterns:
        - "Hardcoded API keys in source code"
        - "Service account keys that never expire"
        - "Passwords as primary authentication for services"
        - "Shared credentials across multiple services"
      example: |
        Application used AWS access key hardcoded in environment variables. Key 
        leaked via misconfigured CI/CD logs. Attacker used key for 3 months before 
        detection. Migrated to IAM roles with STS: application assumes role, receives 
        temporary credentials valid 1 hour. Credentials auto-rotate. Key leak now 
        provides 1-hour window instead of indefinite access.
        
    visibility_enables_security:
      id: "IAM-P006"
      maturity_level: "All levels"
      principle: "Comprehensive identity logging and monitoring enables security"
      rationale: |
        Cannot secure what you cannot see. Identity events (authentication, 
        authorization, permission changes) must be logged and monitored. Who 
        accessed what, when, from where, using which privileges - this visibility 
        enables threat detection, incident response, compliance, and access reviews. 
        Without logging, identity compromise goes undetected.
      implementation:
        - "Log all authentication events (success and failure)"
        - "Log all authorization decisions (grant and deny)"
        - "Log all permission changes (role assignments, policy updates)"
        - "Centralize identity logs in SIEM for detection and alerting"
      metrics:
        - "Percentage of identity systems logging to SIEM: Target 100%"
        - "Identity log retention period: Minimum 90 days hot, 1 year warm"
        - "Identity-based detections deployed: Target >20"
        - "Mean time to detect identity compromise: Target <4 hours"
      anti_patterns:
        - "Authentication logging disabled to reduce noise"
        - "Authorization failures not logged"
        - "Identity logs not centralized or monitored"
        - "Logs deleted after 7 days to save cost"
      example: |
        Attacker compromised service account, lateral movement across cloud 
        infrastructure. No identity logging to SIEM. Compromise discovered 6 weeks 
        later during unrelated audit. Implemented comprehensive identity logging: 
        all authentication, authorization, permission changes to SIEM. Detection 
        rules for anomalous identity behavior. Next credential compromise detected 
        in 2 hours via impossible travel detection.
  
  maturity_model:
    
    purpose: |
      IAM maturity determines organizational security posture and cloud readiness. 
      This model enables assessment of current identity capability, identification 
      of gaps, and roadmap development. Use self-assessment to determine which 
      sections of this chapter apply to your organization.
    
    maturity_levels:
      
      level_0_no_centralized_identity:
        name: "No Centralized Identity"
        characteristics:
          authentication: "Local accounts on each system"
          authorization: "No consistent access control"
          provisioning: "Manual account creation per system"
          deprovisioning: "Manual, often incomplete"
          visibility: "No centralized logging or monitoring"
        indicators:
          - "Users have different passwords for every system"
          - "No SSO or directory service"
          - "IT creates accounts manually via tickets"
          - "Terminated employee accounts remain active"
          - "No visibility into who has access to what"
        risk_level: "Critical - identity compromise undetectable, privilege creep inevitable"
        next_steps: "Deploy directory service (Active Directory or cloud identity), follow building_from_zero"
        estimated_timeline: "6-12 months to reach Level 1"
        
      level_1_basic_directory:
        name: "Basic Directory Service"
        characteristics:
          authentication: "Centralized directory (Active Directory, Azure AD, Google Workspace)"
          authorization: "Basic group-based permissions"
          provisioning: "Manual but centralized"
          deprovisioning: "Manual account disabling"
          visibility: "Directory audit logs available but not monitored"
        indicators:
          - "Single directory for user authentication"
          - "Group-based access control"
          - "Some applications integrated with directory"
          - "Manual provisioning process via IT"
          - "Terminations processed within 24 hours"
        risk_level: "High - manual processes create gaps, limited visibility"
        next_steps: "Deploy SSO, implement automated provisioning, centralize logging"
        estimated_timeline: "6-12 months to reach Level 2"
        
      level_2_sso_and_automation:
        name: "SSO and Basic Automation"
        characteristics:
          authentication: "SSO deployed for major applications"
          authorization: "RBAC with defined roles"
          provisioning: "Automated for common scenarios"
          deprovisioning: "Automated account disabling"
          visibility: "Identity logs centralized in SIEM"
        indicators:
          - "SSO covers >70% of applications"
          - "MFA deployed for remote access"
          - "Automated provisioning from HR system"
          - "Immediate account disabling on termination"
          - "Basic identity threat detection rules"
        risk_level: "Medium - foundational controls in place, gaps in advanced scenarios"
        next_steps: "Implement zero trust, privilege management, comprehensive automation"
        estimated_timeline: "12-18 months to reach Level 3"
        
      level_3_zero_trust_identity:
        name: "Zero Trust Identity"
        characteristics:
          authentication: "Continuous authentication with risk-based MFA"
          authorization: "Attribute-based or relationship-based access control"
          provisioning: "Fully automated lifecycle management"
          deprovisioning: "Immediate cross-platform revocation"
          visibility: "Comprehensive identity analytics and threat detection"
        indicators:
          - "SSO covers >95% of applications"
          - "Device trust enforcement"
          - "Context-aware access policies"
          - "Just-in-time privilege elevation"
          - "Automated access reviews and attestation"
          - "Identity-based threat hunting"
        risk_level: "Low - mature controls, proactive threat detection"
        next_steps: "Advance to passwordless, workload identity, machine learning analytics"
        estimated_timeline: "12-24 months to reach Level 4"
        
      level_4_advanced_identity:
        name: "Advanced Identity Security"
        characteristics:
          authentication: "Passwordless with biometrics and FIDO2"
          authorization: "Policy-based with real-time risk scoring"
          provisioning: "Autonomous with ML-driven access recommendations"
          deprovisioning: "Predictive deprovisioning based on activity patterns"
          visibility: "ML-powered identity threat detection and response"
        indicators:
          - "Passwordless authentication organization-wide"
          - "Workload identity for all services (no service account keys)"
          - "Ephemeral credentials standard practice"
          - "ML-based anomaly detection for identity"
          - "Automated response to identity threats"
          - "Continuous least privilege enforcement"
        risk_level: "Very Low - advanced security posture, continuous improvement"
        next_steps: "Innovation, research, industry leadership"
        
    self_assessment:
      
      instructions: |
        Answer the following questions about your current IAM capability. 
        Score: 1 point for each YES answer. Total score determines maturity level.
        
      questions:
        q1:
          question: "Do you have centralized directory service (Active Directory, Azure AD, Google Workspace)?"
          level_indicator: "Level 0 → Level 1"
          
        q2:
          question: "Do you have SSO deployed for majority of applications?"
          level_indicator: "Level 1 → Level 2"
          
        q3:
          question: "Do you have MFA deployed for remote access?"
          level_indicator: "Level 1 → Level 2"
          
        q4:
          question: "Do you have automated user provisioning from HR system?"
          level_indicator: "Level 1 → Level 2"
          
        q5:
          question: "Do you have automated account disabling on termination?"
          level_indicator: "Level 1 → Level 2"
          
        q6:
          question: "Do you have identity logs centralized in SIEM?"
          level_indicator: "Level 1 → Level 2"
          
        q7:
          question: "Do you enforce device trust before granting access?"
          level_indicator: "Level 2 → Level 3"
          
        q8:
          question: "Do you have just-in-time privilege elevation?"
          level_indicator: "Level 2 → Level 3"
          
        q9:
          question: "Do you have context-aware access policies (location, device, risk)?"
          level_indicator: "Level 2 → Level 3"
          
        q10:
          question: "Do you use continuous authentication and re-verification?"
          level_indicator: "Level 2 → Level 3"
          
        q11:
          question: "Do you have automated access reviews and attestation?"
          level_indicator: "Level 2 → Level 3"
          
        q12:
          question: "Do you use passwordless authentication?"
          level_indicator: "Level 3 → Level 4"
          
        q13:
          question: "Do you use workload identity (no service account keys)?"
          level_indicator: "Level 3 → Level 4"
          
        q14:
          question: "Do you have ML-based identity threat detection?"
          level_indicator: "Level 3 → Level 4"
          
      scoring:
        score_0_1:
          level: "Level 0: No Centralized Identity"
          next_section: "building_from_zero"
          priority: "Deploy directory service and basic identity management"
          
        score_2_4:
          level: "Level 1: Basic Directory"
          next_section: "building_from_zero (Phase 2: SSO deployment)"
          priority: "Deploy SSO and automate provisioning"
          
        score_5_7:
          level: "Level 2: SSO and Automation"
          next_section: "iam_strategy, privilege_management"
          priority: "Implement zero trust and advanced automation"
          
        score_8_11:
          level: "Level 3: Zero Trust Identity"
          next_section: "zero_trust_identity, advanced sections"
          priority: "Passwordless, workload identity, ML analytics"
          
        score_12_14:
          level: "Level 4: Advanced Identity"
          next_section: "All sections for continuous optimization"
          priority: "Innovation and industry leadership"

  building_from_zero:
    
    audience: "Maturity Level 0-1 organizations"
    
    scenario: |
      Greenfield IAM deployment: startup growing beyond local accounts, enterprise 
      acquiring company with no identity infrastructure, or organization recognizing 
      identity chaos during security audit. This section provides 12-month roadmap 
      from local accounts on every system to centralized identity management with 
      SSO and automation.
    
    prerequisites:
      budget: "Estimated $50K-$300K first year (identity platform, integrations, staff)"
      team: "Minimum 1 identity engineer or systems administrator"
      executive_support: "CIO or IT leadership sponsorship"
      application_inventory: "List of all applications requiring identity integration"
      
    phase_1_directory_deployment:
      
      timeline: "Months 1-3"
      objective: "Establish centralized identity repository"
      maturity_progression: "Level 0 → Level 1"
      
      month_1_planning:
        
        goal: "Assess current state and design target architecture"
        
        current_state_assessment:
          user_inventory:
            action: "Document all users and their access"
            method:
              - "Survey departments for headcount"
              - "Identify contractors, vendors, service accounts"
              - "Map users to applications and systems"
            output: "User inventory spreadsheet with access requirements"
            
          application_inventory:
            action: "Catalog all applications requiring authentication"
            categories:
              - "On-premise applications (internal web apps, databases)"
              - "SaaS applications (Salesforce, Workday, GitHub)"
              - "Infrastructure (servers, network devices, cloud platforms)"
            assessment_criteria:
              - "Authentication method (local accounts, LDAP, SAML, OAuth)"
              - "Number of users"
              - "Criticality to business"
              - "Integration complexity"
            output: "Application inventory with integration priority"
            
          pain_point_identification:
            questions:
              - "How long does new employee account setup take?"
              - "How many different passwords do users manage?"
              - "How often are terminated employee accounts still active?"
              - "What applications cannot integrate with directory?"
            output: "Prioritized list of problems to solve"
            
        platform_selection:
          
          decision_factors:
            organizational_context:
              windows_centric: "Active Directory (on-premise or hybrid)"
              cloud_native: "Azure AD, Okta, Google Workspace"
              multi_cloud: "Okta, Azure AD (broad integration ecosystem)"
            budget_constraints:
              high_budget: "Okta, Azure AD Premium"
              medium_budget: "Azure AD, Google Workspace"
              low_budget: "Open source (FreeIPA, OpenLDAP) - requires expertise"
            timeline:
              urgent: "Cloud identity (fast deployment)"
              moderate: "Hybrid AD (flexibility)"
              patient: "On-premise AD (control)"
              
          vendor_comparison:
            
            active_directory:
              strengths:
                - "Industry standard for Windows environments"
                - "Deep Windows integration"
                - "Group Policy for endpoint management"
                - "Mature ecosystem"
              weaknesses:
                - "On-premise infrastructure required"
                - "Limited cloud application support"
                - "Complex for non-Windows environments"
              cost: "$50K-$150K implementation, $20K-$50K annual"
              best_for: "Windows-centric, on-premise applications"
              
            azure_ad:
              strengths:
                - "Cloud-native, no infrastructure"
                - "Excellent Microsoft 365 integration"
                - "Conditional access policies"
                - "Growing SaaS integration library"
              weaknesses:
                - "Less mature than on-premise AD"
                - "Limited on-premise application support without hybrid"
              cost: "$6-$60 per user/month depending on tier"
              best_for: "Microsoft-centric, cloud-first organizations"
              
            okta:
              strengths:
                - "Best-in-class SSO integration library"
                - "Excellent API and automation"
                - "Strong lifecycle management"
                - "Cloud-agnostic"
              weaknesses:
                - "No directory service included (needs backend directory)"
                - "Premium pricing"
              cost: "$3-$15 per user/month"
              best_for: "Multi-cloud, SaaS-heavy environments"
              
            google_workspace:
              strengths:
                - "Includes productivity suite"
                - "Simple administration"
                - "Good for startups and SMBs"
              weaknesses:
                - "Limited enterprise features"
                - "Smaller SSO integration library"
              cost: "$6-$18 per user/month"
              best_for: "Startups, Google-centric organizations"
              
      month_2_directory_implementation:
        
        goal: "Deploy directory service and migrate initial users"
        
        infrastructure_setup:
          on_premise_ad:
            - "Deploy domain controllers (minimum 2 for redundancy)"
            - "Configure DNS and DHCP"
            - "Establish domain structure and OU hierarchy"
            - "Configure group policy baseline"
          cloud_identity:
            - "Provision tenant (Azure AD, Okta, Google)"
            - "Configure custom domain"
            - "Set password policies"
            - "Configure MFA settings"
            
        initial_user_migration:
          pilot_group_selection:
            - "Select IT department as pilot (10-20 users)"
            - "Include mix of roles and use cases"
            - "Avoid critical business users in initial pilot"
          migration_process:
            - "Create user accounts in directory"
            - "Assign group memberships"
            - "Configure MFA enrollment"
            - "Test authentication and access"
          rollback_plan:
            - "Keep local accounts active during pilot"
            - "Document procedure to revert if issues"
            
        group_structure_design:
          organizational_groups:
            - "By department (engineering, sales, finance)"
            - "By location (HQ, remote offices)"
            - "By employee type (FTE, contractor, vendor)"
          access_groups:
            - "Application-specific (salesforce-users, github-users)"
            - "Resource-specific (finance-data-access, engineering-systems)"
            - "Privilege levels (admins, power-users, read-only)"
          best_practices:
            - "Use nested groups (user → role → resource)"
            - "Descriptive naming convention"
            - "Document group purpose and ownership"
            
      month_3_endpoint_integration:
        
        goal: "Integrate workstations and servers with directory"
        
        workstation_domain_join:
          windows:
            - "Domain join workstations to AD"
            - "Apply group policies"
            - "Enable SSO to directory-integrated apps"
          mac:
            - "Bind to directory (AD, Azure AD, Okta)"
            - "Configure Kerberos SSO"
            - "Deploy configuration profiles"
          linux:
            - "Configure SSSD or Winbind for AD integration"
            - "Set up Kerberos authentication"
            - "Configure sudo via AD groups"
            
        server_integration:
          - "Domain join servers or configure LDAP authentication"
          - "Replace local admin accounts with domain accounts"
          - "Implement privilege management (covered in phase 3)"
          
        vpn_integration:
          - "Configure VPN to authenticate against directory"
          - "Require MFA for VPN access"
          - "Deploy client certificates or hardware tokens"
          
    phase_2_sso_deployment:
      
      timeline: "Months 4-6"
      objective: "Deploy SSO and eliminate application-specific passwords"
      maturity_progression: "Level 1 → Level 2"
      
      month_4_sso_platform_deployment:
        
        goal: "Deploy SSO infrastructure and integrate first applications"
        
        sso_platform_selection:
          options:
            azure_ad_sso: "If using Azure AD as directory"
            okta_sso: "If using Okta or want best-in-class integrations"
            google_workspace_sso: "If using Google Workspace"
            
        sso_architecture:
          identity_provider_idp: "SSO platform (Azure AD, Okta)"
          service_provider_sp: "Applications users access"
          protocols:
            saml: "Mature, widely supported, XML-based"
            oidc: "Modern, JSON-based, better for APIs"
            oauth: "Delegation protocol, used with OIDC"
            
        initial_application_integration:
          
          application_prioritization:
            tier_1_critical:
              priority: "Integrate first"
              criteria:
                - "High user count (>50% of organization)"
                - "Daily usage"
                - "Security risk if compromised"
              examples: "Email, file sharing, productivity suite"
              
            tier_2_important:
              priority: "Integrate second"
              criteria:
                - "Moderate user count (20-50% of organization)"
                - "Weekly usage"
                - "Department-critical"
              examples: "CRM, project management, collaboration tools"
              
            tier_3_nice_to_have:
              priority: "Integrate last"
              criteria:
                - "Low user count (<20% of organization)"
                - "Infrequent usage"
                - "Individual tool preferences"
              examples: "Specialized tools, personal apps"
              
          integration_process:
            pre_built_integrations:
              - "Check SSO platform app gallery"
              - "Follow vendor integration guide"
              - "Test with pilot users"
              - "Roll out to all users"
              
            custom_integrations:
              - "Application supports SAML or OIDC"
              - "Configure SSO in application admin panel"
              - "Exchange metadata with identity provider"
              - "Test authentication flow"
              - "Configure attribute mapping (username, email, groups)"
              
            applications_without_sso:
              password_vaulting: "Store passwords in PAM solution"
              reverse_proxy: "Deploy SSO reverse proxy (e.g., Google IAP, Cloudflare Access)"
              retirement: "Consider replacing if security-critical"
              
      month_5_mfa_deployment:
        
        goal: "Deploy multi-factor authentication organization-wide"
        
        mfa_methods:
          
          push_notifications:
            method: "Mobile app push (Duo, Okta Verify, Microsoft Authenticator)"
            pros:
              - "User-friendly"
              - "Hard to phish (compared to SMS)"
            cons:
              - "Requires mobile device"
              - "Push fatigue (users approve without checking)"
            use_case: "Primary MFA method for most users"
            
          totp_authenticator:
            method: "Time-based one-time password (Google Authenticator, Authy)"
            pros:
              - "Works offline"
              - "No phone number required"
            cons:
              - "User must type code"
              - "Can be phished with real-time proxy attacks"
            use_case: "Backup method, users without smartphones"
            
          hardware_tokens:
            method: "FIDO2 security keys (YubiKey, Titan Key)"
            pros:
              - "Strongest security (phishing-resistant)"
              - "No batteries, long-lived"
            cons:
              - "Cost ($20-50 per key)"
              - "Users must carry physical token"
            use_case: "High-privilege users (admins, executives)"
            
          sms_codes:
            method: "SMS text message with code"
            pros:
              - "No app installation required"
              - "Familiar to users"
            cons:
              - "Vulnerable to SIM swapping"
              - "Network-dependent"
              - "Not NIST-recommended"
            use_case: "Avoid if possible, only for legacy systems"
            
        mfa_rollout_strategy:
          
          phase_1_admins:
            target: "IT administrators and privileged users"
            timeline: "Week 1"
            method: "Hardware tokens"
            rationale: "Highest risk if compromised"
            
          phase_2_remote_access:
            target: "All users for VPN and remote access"
            timeline: "Week 2-3"
            method: "Push notifications or TOTP"
            rationale: "External access highest risk"
            
          phase_3_all_users:
            target: "All users for all applications"
            timeline: "Week 4-6"
            method: "Push notifications with TOTP backup"
            rationale: "Complete MFA coverage"
            
          user_communication:
            - "Announce MFA requirement 2 weeks in advance"
            - "Provide enrollment instructions and support"
            - "Offer training sessions"
            - "IT help desk prepared for enrollment assistance"
            
      month_6_sso_expansion:
        
        goal: "Integrate remaining applications and achieve >90% SSO coverage"
        
        integration_acceleration:
          - "Integrate Tier 2 applications (department-critical)"
          - "Address custom applications requiring SAML/OIDC configuration"
          - "Deploy SSO reverse proxy for legacy apps"
          - "Retire or replace applications that cannot integrate"
          
        password_vault_deployment:
          use_case: "Applications without SSO support"
          solutions: "1Password, LastPass Enterprise, CyberArk"
          configuration:
            - "Integrate with SSO for vault access"
            - "Store application credentials in vault"
            - "Users access vault via SSO, vault provides app credentials"
            - "Rotate stored credentials quarterly"
            
        success_metrics:
          - "SSO coverage: >90% of applications"
          - "User adoption: >95% of users using SSO daily"
          - "Password reset tickets: 50%+ reduction"
          - "MFA enrollment: 100% of users"

    phase_3_automation_and_governance:
      
      timeline: "Months 7-9"
      objective: "Automate identity lifecycle and establish governance"
      maturity_progression: "Level 2 optimization"
      
      month_7_automated_provisioning:
        
        goal: "Automate user provisioning from HR system"
        
        hr_system_integration:
          
          identity_authoritative_source:
            concept: "HR system is source of truth for user identity"
            data_elements:
              - "Employee ID (unique identifier)"
              - "Name, email, department, manager"
              - "Job title, location, employment type"
              - "Hire date, termination date, role changes"
            
          integration_architecture:
            
            push_based:
              method: "HR system pushes events to identity platform"
              technologies: "Webhooks, API calls, message queues"
              advantages:
                - "Real-time or near-real-time provisioning"
                - "Event-driven (hire, terminate, role change)"
              disadvantages:
                - "Requires HR system customization"
                - "More complex to implement"
              use_case: "Modern HR platforms with API support"
              
            pull_based:
              method: "Identity platform polls HR system periodically"
              technologies: "Scheduled API calls, SCIM, CSV import"
              advantages:
                - "Simpler implementation"
                - "Works with legacy HR systems"
              disadvantages:
                - "Delay between HR event and provisioning"
                - "Polling frequency vs latency tradeoff"
              use_case: "Legacy HR systems without webhook support"
              
        provisioning_workflows:
          
          new_hire_workflow:
            trigger: "HR creates employee record"
            automated_actions:
              step_1: "Create user account in directory"
              step_2: "Assign to groups based on department and role"
              step_3: "Provision email account"
              step_4: "Grant access to standard applications (SSO)"
              step_5: "Send welcome email with enrollment instructions"
              step_6: "Create ticket for hardware provisioning"
            timing: "Complete within 4 hours of hire event"
            
          role_change_workflow:
            trigger: "HR updates job title or department"
            automated_actions:
              step_1: "Identify permission changes required"
              step_2: "Add new permissions"
              step_3: "Flag old permissions for review (don't auto-remove)"
              step_4: "Notify manager for access review"
            timing: "Initiate within 24 hours of change"
            
          termination_workflow:
            trigger: "HR sets termination date or disables employee"
            automated_actions:
              step_1: "Disable user account immediately (within 15 minutes)"
              step_2: "Revoke SSO sessions (force re-authentication)"
              step_3: "Disable email forwarding and shared mailbox access"
              step_4: "Revoke access to all applications"
              step_5: "Notify manager to reassign owned resources"
              step_6: "Schedule account deletion after retention period"
            timing: "Critical - execute within 15 minutes"
            
      month_8_access_governance:
        
        goal: "Implement access reviews and attestation"
        
        access_review_framework:
          
          quarterly_manager_reviews:
            scope: "Manager reviews direct reports' access"
            process:
              step_1: "System generates report: user → applications → permissions"
              step_2: "Manager reviews each user's access"
              step_3: "Manager attests access is appropriate or flags for removal"
              step_4: "Flagged access automatically revoked"
              step_5: "Attestation recorded for audit"
            automation: "Email workflow with approve/deny buttons"
            
          application_owner_reviews:
            scope: "App owner reviews all users with access to their application"
            frequency: "Quarterly"
            focus: "Identify users who no longer need access"
            
          privileged_access_reviews:
            scope: "Admin and privileged accounts"
            frequency: "Monthly (more frequent due to risk)"
            focus: "Verify privileged access still required"
            
        segregation_of_duties:
          
          concept: "Prevent single user from having conflicting permissions"
          
          sod_policies:
            financial_controls:
              conflict: "User cannot both approve and execute payments"
              enforcement: "System prevents assignment of both permissions"
            
            it_controls:
              conflict: "Developer cannot deploy to production without approval"
              enforcement: "Separate groups for dev and prod access"
              
            security_controls:
              conflict: "Security engineer cannot bypass their own access restrictions"
              enforcement: "Segregated admin roles, approval required"
              
          implementation:
            - "Define SoD policies per regulation (SOX, PCI, HIPAA)"
            - "Map policies to permission sets"
            - "Configure automated checks in IAM system"
            - "Alert on policy violations"
            - "Require exception approval and documentation"
            
      month_9_service_account_governance:
        
        goal: "Establish service account management and hygiene"
        
        service_account_discovery:
          challenge: "Service accounts proliferate without tracking"
          discovery_methods:
            directory_query: "Query directory for non-interactive accounts"
            authentication_logs: "Identify accounts with API/service authentication patterns"
            application_audit: "Survey application teams for service accounts"
          output: "Complete inventory of service accounts with owners"
          
        service_account_lifecycle:
          
          creation_process:
            request: "Developer submits service account request"
            approval: "Security and application owner approve"
            provisioning: "Automated creation with metadata"
            metadata_required:
              - "Owner (team responsible)"
              - "Purpose (what application or service)"
              - "Expiration date (force review)"
              - "Permissions required (least privilege)"
              
          credential_management:
            long_lived_credentials:
              problem: "API keys and passwords never rotated"
              mitigation:
                - "Mandatory 90-day rotation"
                - "Automated rotation where possible"
                - "Monitoring for credential age"
            short_lived_credentials:
              preferred: "Ephemeral credentials via workload identity"
              implementation:
                - "Cloud platforms: IAM roles for services"
                - "Kubernetes: Service account tokens"
                - "OAuth: Client credentials with short-lived tokens"
                
          permission_reviews:
            frequency: "Quarterly for each service account"
            process:
              - "Owner attests account still needed"
              - "Owner attests permissions are least privilege"
              - "Unused accounts automatically disabled"
              
    phase_4_maturity_and_optimization:
      
      timeline: "Months 10-12"
      objective: "Optimize IAM program and prepare for zero trust"
      maturity_progression: "Level 2 → Level 3 preparation"
      
      month_10_identity_analytics:
        
        goal: "Deploy identity analytics and threat detection"
        
        identity_logging:
          log_sources:
            - "Authentication events (login success/failure)"
            - "Authorization decisions (access granted/denied)"
            - "Permission changes (role assignments, policy updates)"
            - "Privileged actions (password resets, group modifications)"
          centralization: "Forward all identity logs to SIEM"
          retention: "90 days hot, 1 year warm, 7 years cold"
          
        identity_threat_detection:
          detection_rules:
            impossible_travel:
              logic: "User login from two locations <4 hours apart"
              severity: "High"
            
            brute_force:
              logic: "More than 10 failed logins in 5 minutes"
              severity: "Medium"
              
            privilege_escalation:
              logic: "User added to admin group"
              severity: "High"
              
            after_hours_admin:
              logic: "Administrative action outside business hours"
              severity: "Medium"
              
            dormant_account_login:
              logic: "Account inactive >90 days suddenly active"
              severity: "High"
              
          integration: "Reference Chapter 2.4 Detection Engineering for full methodology"
          
      month_11_privilege_management:
        
        goal: "Implement just-in-time access and privilege analytics"
        
        just_in_time_access:
          concept: "Grant elevated privileges only when needed, automatically revoke"
          
          implementation:
            request_workflow:
              - "User requests elevated access via portal"
              - "Manager or security approves (or auto-approve for pre-authorized scenarios)"
              - "Privileges granted for time-bound period (1-8 hours)"
              - "Privileges automatically revoked after expiration"
              
            break_glass_accounts:
              use_case: "Emergency access when normal procedures fail"
              implementation:
                - "Dedicated admin accounts stored offline"
                - "Break glass credentials in sealed envelope or hardware vault"
                - "Usage triggers immediate incident response"
                - "All actions audited and reviewed"
                
        privileged_access_workstations:
          concept: "Dedicated hardened workstations for admin tasks"
          requirements:
            - "Separate from regular workstations"
            - "No internet browsing or email"
            - "Enhanced logging and monitoring"
            - "MFA required for all access"
          rationale: "Prevent credential theft via phishing or malware on regular workstation"
          
      month_12_metrics_and_continuous_improvement:
        
        goal: "Establish IAM program metrics and improvement process"
        
        iam_program_kpis:
          
          provisioning_metrics:
            - "Time to provision new hire: Target <4 hours"
            - "Time to deprovision terminated employee: Target <1 hour"
            - "Percentage of provisioning automated: Target >90%"
            - "Orphaned accounts: Target = 0"
            
          access_governance_metrics:
            - "Access review completion rate: Target 100%"
            - "Average time to complete access review: Target <5 days"
            - "Permissions revoked per review cycle: Track trend"
            - "SoD violations: Target = 0"
            
          authentication_metrics:
            - "SSO coverage: Target >95%"
            - "MFA enrollment: Target 100%"
            - "Password reset tickets: Track reduction trend"
            - "Failed authentication rate: Track for anomalies"
            
          security_metrics:
            - "Mean time to detect identity compromise: Target <4 hours"
            - "Service accounts with rotated credentials: Target >90%"
            - "Privileged accounts with MFA: Target 100%"
            - "Identity-based security incidents: Track trend"
            
        continuous_improvement_cycle:
          monthly:
            - "Review operational metrics"
            - "Address provisioning delays or errors"
            - "Tune detection rules based on false positives"
            
          quarterly:
            - "Conduct access reviews"
            - "Assess SSO integration progress"
            - "Update threat detection rules"
            - "Review and rotate service account credentials"
            
          annually:
            - "Comprehensive IAM program assessment"
            - "Benchmark against industry standards"
            - "Update IAM strategy and roadmap"
            - "Budget planning for next year"
  
  iam_strategy:
    
    audience: "Level 2+ organizations with foundational IAM"
    
    overview: |
      IAM strategy determines how identity and access decisions are made at scale. 
      This section addresses authentication architecture, authorization models, 
      and strategic decisions for enterprise identity management. Organizations 
      with basic directory and SSO use this section to mature toward zero trust 
      and advanced access control.
      
    authentication_architecture:
      
      authentication_vs_authorization:
        
        authentication:
          definition: "Proving who you are (identity verification)"
          methods:
            - "Something you know (password, PIN)"
            - "Something you have (phone, hardware token)"
            - "Something you are (biometric)"
          outcome: "Authenticated identity (user ID, email)"
          
        authorization:
          definition: "Determining what you can access (permission evaluation)"
          inputs:
            - "Authenticated identity"
            - "Requested resource"
            - "Context (time, location, device)"
          outcome: "Access granted or denied"
          
        separation_of_concerns:
          principle: "Authentication and authorization are distinct responsibilities"
          rationale: "User authenticates once (SSO), authorization evaluated per resource"
          
      authentication_factors:
        
        single_factor:
          definition: "One authentication method (typically password)"
          risk: "Compromise of single factor grants full access"
          use_case: "Low-risk applications only (not recommended)"
          
        multi_factor:
          definition: "Two or more authentication methods"
          combinations:
            strong: "Password + hardware token"
            moderate: "Password + push notification"
            weak: "Password + SMS (vulnerable to SIM swap)"
          recommendation: "Require MFA for all external access, privileged access"
          
        risk_based_authentication:
          definition: "Authentication requirements vary based on risk signals"
          risk_signals:
            - "Login location (known vs unknown)"
            - "Device posture (managed vs unmanaged)"
            - "Time of day (business hours vs 3 AM)"
            - "Resource sensitivity (public app vs financial system)"
          behavior:
            low_risk: "Authenticate with password only"
            medium_risk: "Require MFA"
            high_risk: "Block access or require additional verification"
          implementation: "Conditional access policies in SSO platform"
          
      authentication_protocols:
        
        saml:
          name: "Security Assertion Markup Language"
          use_case: "Enterprise SSO, web applications"
          flow:
            - "User accesses application (Service Provider)"
            - "Application redirects to SSO (Identity Provider)"
            - "User authenticates at SSO"
            - "SSO returns SAML assertion to application"
            - "Application validates assertion and grants access"
          pros:
            - "Mature, widely adopted"
            - "Strong security features"
            - "Extensive enterprise support"
          cons:
            - "XML-based (verbose, complex)"
            - "Certificate management required"
            - "Primarily web-based"
          
        oidc:
          name: "OpenID Connect"
          use_case: "Modern applications, APIs, mobile apps"
          flow:
            - "User accesses application (Relying Party)"
            - "Application redirects to SSO (OpenID Provider)"
            - "User authenticates at SSO"
            - "SSO returns ID token (JWT) to application"
            - "Application validates token and grants access"
          pros:
            - "Modern, JSON-based"
            - "Better for mobile and API authentication"
            - "Built on OAuth 2.0"
          cons:
            - "Newer (less enterprise adoption than SAML)"
            - "Requires understanding of OAuth flows"
          
        oauth:
          name: "OAuth 2.0"
          use_case: "Delegated authorization, API access"
          flow:
            - "Application requests access to resource on behalf of user"
            - "User authorizes application at authorization server"
            - "Application receives access token"
            - "Application uses access token to access resource API"
          important: "OAuth is authorization, not authentication (use with OIDC for authentication)"
          
        kerberos:
          name: "Kerberos"
          use_case: "Windows environments, internal networks"
          flow:
            - "User authenticates to Key Distribution Center (KDC)"
            - "KDC issues Ticket Granting Ticket (TGT)"
            - "User requests service ticket for specific resource"
            - "User presents service ticket to access resource"
          pros:
            - "Single sign-on within domain"
            - "Strong cryptographic security"
            - "Efficient (no password transmission)"
          cons:
            - "Complex configuration"
            - "Time synchronization required"
            - "Limited to network environments"
            
      passwordless_authentication:
        
        rationale: "Passwords are weakest link - phishable, reused, forgotten"
        
        fido2_webauthn:
          method: "Hardware security keys with cryptographic challenge-response"
          user_experience:
            - "User inserts security key or uses biometric"
            - "No password typing required"
            - "Phishing-resistant (domain-bound)"
          implementation:
            - "Deploy FIDO2-compatible security keys (YubiKey, Titan)"
            - "Configure SSO platform for WebAuthn"
            - "Enroll users with security keys"
            - "Backup method required (second key or recovery codes)"
          pros:
            - "Strongest authentication method"
            - "Phishing-resistant"
            - "Fast user experience"
          cons:
            - "Hardware cost"
            - "User must carry physical key"
            - "Key loss requires recovery process"
            
        biometric_authentication:
          methods:
            - "Fingerprint (Touch ID, Windows Hello)"
            - "Facial recognition (Face ID)"
            - "Iris scanning"
          implementation:
            - "Requires biometric-capable devices"
            - "Biometric data stored locally on device (not centralized)"
            - "Used with platform authenticators (Apple, Microsoft, Google)"
          pros:
            - "Convenient (no password or hardware key)"
            - "Difficult to steal or replicate"
          cons:
            - "Privacy concerns (biometric data)"
            - "Not all devices support"
            - "Accessibility considerations"
            
        magic_links:
          method: "Email or SMS link for authentication"
          flow:
            - "User enters email address"
            - "System sends time-limited authentication link"
            - "User clicks link to authenticate"
          pros:
            - "No password to remember"
            - "Simple user experience"
          cons:
            - "Email compromise = account compromise"
            - "Requires email access"
            - "Not suitable for high-security scenarios"
          use_case: "Consumer apps, low-security scenarios"
          
    authorization_patterns:
      
      overview: |
        Authorization determines what authenticated users can access. The choice 
        of authorization model affects scalability, security, and operational 
        complexity. This section compares major authorization models and provides 
        guidance on selection and implementation.
        
      rbac:
        name: "Role-Based Access Control"
        
        concept: "Users assigned to roles, roles have permissions"
        
        structure:
          users: "Individual people"
          roles: "Job functions (developer, manager, analyst)"
          permissions: "Actions on resources (read, write, delete)"
          assignment: "User → Role → Permission"
          
        example:
          role: "Database Developer"
          permissions:
            - "Read dev database"
            - "Write dev database"
            - "Read test database"
          users: "All developers in engineering department"
          
        advantages:
          - "Simple to understand and implement"
          - "Aligns with organizational structure"
          - "Widely supported by applications"
          - "Easier to audit (what can this role do?)"
          
        disadvantages:
          - "Role explosion (hundreds of roles as org grows)"
          - "Static (cannot adapt to dynamic context)"
          - "Coarse-grained (difficulty with fine-grained permissions)"
          - "Role assignment becomes complex at scale"
          
        best_for: "Traditional enterprises, stable organizational structure"
        
      abac:
        name: "Attribute-Based Access Control"
        
        concept: "Access decisions based on attributes of user, resource, environment"
        
        attributes:
          user_attributes:
            - "Department, job title, clearance level"
            - "Location, employment type"
          resource_attributes:
            - "Classification (public, internal, confidential)"
            - "Owner, creation date"
          environment_attributes:
            - "Time of day, day of week"
            - "Network location, device type"
            
        policy_example:
          rule: "Grant access if:"
          conditions:
            - "User.department == Resource.department"
            - "User.clearance_level >= Resource.classification"
            - "Environment.time between 08:00 and 18:00"
            - "Device.managed == true"
            
        advantages:
          - "Fine-grained access control"
          - "Dynamic (adapts to context)"
          - "Scales better than RBAC (fewer policies than roles)"
          - "Supports complex business logic"
          
        disadvantages:
          - "Complex to design and implement"
          - "Difficult to audit and troubleshoot"
          - "Performance overhead (policy evaluation)"
          - "Requires attribute management infrastructure"
          
        best_for: "Complex security requirements, dynamic environments, cloud-native"
        
      rebac:
        name: "Relationship-Based Access Control"
        
        concept: "Access based on relationships between entities"
        
        graph_structure:
          entities: "Users, groups, resources, organizations"
          relationships: "Member of, owner of, manager of, parent of"
          
        example:
          relationship: "Alice manages Bob"
          rule: "Managers can view direct reports' files"
          result: "Alice can access Bob's files"
          
        use_cases:
          hierarchical_organizations:
            - "Managers access direct reports' resources"
            - "Department heads access all department resources"
          multi_tenant_systems:
            - "Organization members access organization resources"
            - "No cross-organization access"
          social_platforms:
            - "Friends can view profiles"
            - "Groups can share documents"
            
        advantages:
          - "Natural for hierarchical access"
          - "Handles multi-tenancy elegantly"
          - "Relationships already exist in organization"
          
        disadvantages:
          - "Requires graph database or complex queries"
          - "Can be difficult to reason about at scale"
          - "Performance considerations for deep hierarchies"
          
        best_for: "Multi-tenant SaaS, hierarchical organizations, social platforms"
        
      authorization_architecture_patterns:
        
        embedded_authorization:
          description: "Authorization logic in application code"
          example: "if (user.role == 'admin') { allow(); }"
          pros:
            - "Simple for small applications"
            - "Low latency (no external calls)"
          cons:
            - "Policy changes require code deployment"
            - "Difficult to audit across applications"
            - "Inconsistent enforcement"
          use_case: "Single application, simple permissions"
          
        centralized_authorization_service:
          description: "Dedicated service evaluates authorization policies"
          architecture:
            - "Application asks authorization service: Can User X do Action Y on Resource Z?"
            - "Authorization service evaluates policies and returns decision"
          pros:
            - "Centralized policy management"
            - "Consistent enforcement across applications"
            - "Policy changes without code deployment"
            - "Easier auditing and compliance"
          cons:
            - "Network latency for every authorization check"
            - "Single point of failure (requires HA)"
            - "Performance bottleneck at scale"
          use_case: "Multiple applications, complex policies"
          
        policy_engine:
          description: "Distribute policy engine with applications, centrally manage policies"
          examples: "Open Policy Agent (OPA), Casbin"
          architecture:
            - "Each application embeds policy engine"
            - "Policies distributed from central management"
            - "Engine evaluates policies locally"
          pros:
            - "Low latency (local evaluation)"
            - "Scalable (no central bottleneck)"
            - "Centralized policy management"
          cons:
            - "Policy distribution complexity"
            - "Version skew between applications"
          use_case: "Microservices, cloud-native, high-scale"
          
  privilege_management:
    
    audience: "Level 2+ organizations implementing privilege controls"
    
    overview: |
      Privileged accounts are highest-value targets for attackers. Compromise of 
      administrative credentials enables lateral movement, data exfiltration, and 
      persistent access. Privilege management addresses protection of high-value 
      accounts through isolation, monitoring, and just-in-time access.
      
    privileged_account_types:
      
      domain_administrators:
        scope: "Full control over directory and domain-joined systems"
        risk: "Compromise enables persistent access to entire environment"
        examples: "Active Directory Domain Admins, Azure AD Global Admin"
        
      cloud_administrators:
        scope: "Full control over cloud infrastructure"
        risk: "Compromise enables resource creation, data access, cost abuse"
        examples: "AWS root account, GCP Owner, Azure Subscription Owner"
        
      database_administrators:
        scope: "Full access to databases and data"
        risk: "Compromise enables data exfiltration, modification, deletion"
        examples: "MySQL root, PostgreSQL superuser, SQL Server sa"
        
      application_administrators:
        scope: "Administrative functions within application"
        risk: "Compromise enables unauthorized actions, data access"
        examples: "SaaS admin accounts, application super users"
        
      emergency_access:
        scope: "Break-glass accounts for disaster recovery"
        risk: "Highest privilege, should never be used in normal operations"
        examples: "Emergency admin accounts, root accounts"
        
    privileged_access_management:
      
      password_vaulting:
        
        concept: "Store privileged credentials in encrypted vault, control access"
        
        implementation:
          credential_storage:
            - "Privileged passwords stored in vault, not known to users"
            - "Strong encryption at rest"
            - "Access requires authentication and authorization"
            
          check_out_check_in:
            - "User requests access to privileged account"
            - "Approval workflow (automatic or manual)"
            - "Vault provides credentials for time-limited session"
            - "Session recorded for audit"
            - "Credentials rotated after check-in"
            
          password_rotation:
            - "Automatic password rotation on schedule (daily/weekly)"
            - "Rotation after each use"
            - "Verification that rotation succeeded"
            
        pam_solutions:
          commercial: "CyberArk, BeyondTrust, Delinea"
          open_source: "HashiCorp Vault, Teleport"
          
      session_management:
        
        session_recording:
          what: "Record all privileged session activity (keystrokes, commands, screen)"
          why: "Audit trail, incident investigation, compliance"
          implementation:
            - "PAM solution acts as proxy between user and target system"
            - "All activity recorded and stored"
            - "Searchable by user, time, system, commands"
            
        session_monitoring:
          what: "Real-time monitoring of privileged sessions"
          why: "Detect malicious activity during session"
          implementation:
            - "Anomaly detection on commands executed"
            - "Alert on suspicious activity (mass deletion, credential dumping)"
            - "Ability to terminate session if malicious"
            
      just_in_time_access:
        
        concept: "Grant privileged access only when needed, automatically revoke"
        
        implementation:
          
          request_workflow:
            step_1: "User requests elevated access via self-service portal"
            step_2: "Specify resource, permission level, duration, business justification"
            step_3: "Approval (automatic based on rules or manual by manager/security)"
            step_4: "Temporary access granted (1-8 hours typical)"
            step_5: "Access automatically revoked after expiration"
            step_6: "All activity logged and auditable"
            
          approval_automation:
            low_risk: "Auto-approve for pre-authorized scenarios"
            medium_risk: "Manager approval required"
            high_risk: "Security team approval required"
            
        advantages:
          - "Reduces standing privileges (smaller attack surface)"
          - "Limits blast radius (time-bound access)"
          - "Improves auditability (access tied to business justification)"
          - "Enforces least privilege principle"
          
      privilege_analytics:
        
        dormant_accounts:
          detection: "Privileged accounts with no activity in >90 days"
          action: "Disable or delete after review"
          
        excessive_privileges:
          detection: "Users with admin rights who never use them"
          action: "Revoke unnecessary privileges"
          
        privilege_creep:
          detection: "Users accumulating permissions over time"
          action: "Regular access reviews and cleanup"
          
        anomalous_usage:
          detection: "Privileged account activity outside normal patterns"
          examples:
            - "Admin login from unusual location"
            - "Commands never executed before"
            - "Access to systems not normally accessed"
          action: "Alert security team, potentially block"

  service_account_governance:
    
    audience: "Level 2+ organizations managing service-to-service authentication"
    
    overview: |
      Service accounts authenticate applications and services, not humans. They 
      proliferate rapidly, often have excessive permissions, and use long-lived 
      credentials. Service account compromise enables persistent access without 
      triggering user-based detections. This section addresses discovery, lifecycle, 
      and security of non-human identities.
      
    service_account_challenges:
      
      proliferation:
        problem: "Service accounts created ad-hoc without tracking"
        scale: "10-100x more service accounts than users in large organizations"
        symptoms:
          - "No central inventory"
          - "Unknown owners"
          - "Cannot determine purpose"
          
      excessive_permissions:
        problem: "Service accounts granted admin rights for convenience"
        rationale: "Developer doesn't know minimum permissions, grants owner/admin"
        risk: "Compromise of service account = full environment access"
        
      long_lived_credentials:
        problem: "API keys and passwords never rotated"
        reality: "Service account keys 5+ years old common"
        risk: "Years of opportunity for credential theft"
        
      no_mfa:
        problem: "Service accounts authenticate with password/key only"
        rationale: "No human to perform MFA interaction"
        risk: "Stolen credential = immediate access"
        
    service_account_lifecycle:
      
      discovery_and_inventory:
        
        discovery_methods:
          directory_query:
            - "Query directory for accounts with 'svc-' prefix or non-interactive flag"
            - "Identify accounts with no password expiration"
            - "Find accounts that never login interactively"
            
          authentication_log_analysis:
            - "Analyze SIEM for service authentication patterns"
            - "Identify accounts with API/programmatic authentication only"
            - "Find accounts authenticating 24/7 or in regular intervals"
            
          application_survey:
            - "Survey application teams for service accounts"
            - "Review CI/CD systems for stored credentials"
            - "Audit cloud platforms for service accounts and keys"
            
        inventory_attributes:
          - "Account name and unique ID"
          - "Owner (team responsible)"
          - "Purpose (what application or service)"
          - "Permissions granted"
          - "Credential type (password, key, certificate)"
          - "Credential age and last rotation"
          - "Last authentication time"
          - "Expiration date (force review)"
          
      service_account_creation_process:
        
        request_and_approval:
          step_1: "Developer submits service account request via portal"
          step_2: "Specify purpose, required permissions, expiration"
          step_3: "Security reviews and approves (or requests clarification)"
          step_4: "Automated provisioning with approved parameters"
          
        least_privilege_enforcement:
          principle: "Grant minimum permissions required for service function"
          implementation:
            - "Start with read-only access"
            - "Add write permissions only if required"
            - "Never grant admin unless absolutely necessary"
            - "Document justification for each permission"
            
        naming_convention:
          purpose: "Identify service accounts and their purpose from name"
          examples:
            - "svc-app-database-reader (service, app name, function)"
            - "sa-cicd-deploy (service account, system, function)"
          
      credential_rotation:
        
        automated_rotation:
          implementation:
            - "PAM solution rotates credentials on schedule"
            - "Application retrieves new credential from vault"
            - "Old credential invalidated"
          frequency: "30-90 days recommended"
          
        rotation_challenges:
          legacy_applications:
            problem: "Hardcoded credentials in config files"
            mitigation:
              - "Migrate to secret management (Vault, AWS Secrets Manager)"
              - "Use configuration management to deploy rotated credentials"
              
          distributed_systems:
            problem: "Multiple services sharing credential, rotation breaks one"
            mitigation:
              - "Each service gets unique credential"
              - "Coordinate rotation windows"
              
      ephemeral_credentials:
        
        workload_identity:
          concept: "Service authenticates using platform-provided identity, no keys"
          
          aws_iam_roles:
            - "EC2 instance assumes IAM role"
            - "Application uses IMDSv2 to retrieve temporary credentials"
            - "Credentials rotate automatically every hour"
            - "No long-lived access keys required"
            
          gcp_service_accounts:
            - "Compute instance uses service account attached to instance"
            - "Application uses metadata service to get tokens"
            - "Tokens short-lived and automatically refreshed"
            
          azure_managed_identity:
            - "VM or App Service assigned managed identity"
            - "Application authenticates using Azure Instance Metadata Service"
            - "No credentials to manage"
            
          kubernetes_service_accounts:
            - "Pod uses Kubernetes service account"
            - "Token automatically mounted in pod"
            - - "Token bound to pod lifetime"
            
        oauth_client_credentials:
          - "Service authenticates to authorization server"
          - "Receives short-lived access token"
          - "Uses token to access APIs"
          - "Token expires (1-24 hours), service requests new token"
          
      service_account_monitoring:
        
        detection_use_cases:
          anomalous_authentication:
            - "Service account login from unexpected location"
            - "Authentication from IP not associated with known infrastructure"
            
          privilege_escalation:
            - "Service account permissions elevated"
            - "Service account added to admin groups"
            
          lateral_movement:
            - "Service account accessing systems outside normal scope"
            - "Unusual API calls or resource access"
            
          credential_theft_indicators:
            - "Multiple simultaneous authentications from different IPs"
            - "Authentication patterns inconsistent with service behavior"
            
  zero_trust_identity:
    
    audience: "Level 3+ organizations implementing zero trust architecture"
    
    overview: |
      Zero trust identity assumes breach and continuously verifies every access 
      request. Traditional security: authenticate once, trust for session. Zero 
      trust: verify user, device, context for every access decision. This section 
      addresses continuous authentication, device trust, and context-aware access.
      
    zero_trust_principles:
      
      never_trust_always_verify:
        traditional: "Authenticate at login, trust for 8-hour session"
        zero_trust: "Verify identity, device, context for every resource access"
        
      assume_breach:
        traditional: "Trust internal network, authenticated users"
        zero_trust: "Assume attacker inside, verify everything"
        
      least_privilege:
        traditional: "Grant broad permissions, revoke when user leaves"
        zero_trust: "Grant minimum required, time-bound, continuously validate"
        
    continuous_authentication:
      
      session_verification:
        
        traditional_approach:
          - "User logs in with password + MFA at 8 AM"
          - "Receives session token valid until logout or timeout (8 hours)"
          - "Token grants access to all authorized resources"
          problem: "Attacker steals token, full access until expiration"
          
        continuous_approach:
          - "User authenticates initially"
          - "Session validity re-verified periodically (every 15-60 minutes)"
          - "Re-verification checks: device still compliant, location unchanged, behavior normal"
          - "High-risk actions trigger additional authentication"
          result: "Stolen session token has limited validity, high-risk actions blocked"
          
      risk_based_step_up:
        
        concept: "Require additional authentication when risk increases"
        
        risk_signals:
          low_risk:
            - "Known device, known location, business hours"
            - "Action: Read access to normal resources"
          medium_risk:
            - "Unknown location, after hours, unmanaged device"
            - "Action: Require MFA re-authentication"
          high_risk:
            - "Impossible travel, high-value resource, privileged action"
            - "Action: Require MFA + manager approval, or block"
            
        step_up_examples:
          - "User accessing financial data from coffee shop → require MFA"
          - "Admin attempting privilege escalation at 2 AM → require MFA + approval"
          - "Bulk data download from new device → block, require re-authentication and justification"
          
    device_trust:
      
      managed_vs_unmanaged:
        
        managed_devices:
          definition: "Devices owned and managed by organization"
          characteristics:
            - "MDM/UEM agent installed (Jamf, Intune, Workspace ONE)"
            - "Security policies enforced (encryption, patching, EDR)"
            - "Compliance validated continuously"
          trust_level: "Higher - known security posture"
          
        unmanaged_devices:
          definition: "BYOD or personal devices"
          characteristics:
            - "No MDM enrollment"
            - "Unknown security posture"
            - "Potentially compromised"
          trust_level: "Lower - assume insecure"
          
      device_compliance_checks:
        
        encryption:
          requirement: "Full disk encryption enabled"
          validation: "MDM reports encryption status"
          enforcement: "Block access if encryption disabled"
          
        os_version:
          requirement: "Operating system up to date"
          validation: "Device reports OS version to MDM"
          enforcement: "Block if OS version unsupported or critically outdated"
          
        edr_agent:
          requirement: "Endpoint detection agent installed and running"
          validation: "EDR platform reports agent health"
          enforcement: "Block if agent disabled or unhealthy"
          
        jailbreak_rooted:
          requirement: "Device not jailbroken or rooted"
          validation: "MDM detects jailbreak/root status"
          enforcement: "Block access from compromised devices"
          
      device_based_access_policies:
        
        managed_device_full_access:
          - "Compliant managed device → full access to resources"
          - "User can access internal applications, sensitive data"
          
        unmanaged_device_limited_access:
          - "Unmanaged device → limited access only"
          - "Web-based access only (no client apps)"
          - "Cannot download or sync data"
          - "Session isolation (no local caching)"
          
        non_compliant_device_blocked:
          - "Managed device out of compliance → access blocked"
          - "User must remediate (enable encryption, update OS) before access restored"
          
    context_aware_access:
      
      contextual_signals:
        
        location:
          - "Geographic location (country, city, IP address)"
          - "Network context (corporate, VPN, public WiFi, home)"
          trusted_locations: "Office, VPN, known home networks"
          untrusted_locations: "Public WiFi, foreign countries, Tor exit nodes"
          
        time:
          - "Time of day, day of week"
          - "Expected work hours based on user profile"
          anomaly: "Access at 3 AM when user normally works 9-5"
          
        behavioral:
          - "Access patterns, resource usage, typical workflows"
          - "Deviation from baseline behavior"
          anomaly: "Developer suddenly accessing HR systems"
          
        threat_intelligence:
          - "IP reputation, known malicious infrastructure"
          - "Geolocation associated with threat actors"
          action: "Block access from known-bad IPs"
          
      policy_examples:
        
        sensitive_data_access:
          policy:
            - "Allow if: managed device AND trusted location AND business hours"
            - "Require MFA if: managed device AND untrusted location"
            - "Block if: unmanaged device OR high-risk location"
            
        administrative_actions:
          policy:
            - "Allow if: privileged user AND managed device AND trusted location"
            - "Require approval if: after hours OR untrusted location"
            - "Block if: impossible travel OR unmanaged device"
            
        external_collaboration:
          policy:
            - "Allow read-only access for partners"
            - "Require MFA for any access"
            - "Block download and sync"
            - "Session expires after 2 hours"
            
    zero_trust_network_access:
      
      concept: "Replace VPN with identity-based micro-tunnels"
      
      traditional_vpn_problems:
        - "Binary access (on VPN = trusted, off VPN = untrusted)"
        - "Full network access once connected (lateral movement easy)"
        - "No per-application access control"
        - "Performance bottleneck (all traffic through VPN)"
        
      ztna_approach:
        - "Identity-based access per application"
        - "No network-level access (cannot ping or scan)"
        - "Least privilege (access only to authorized apps)"
        - "Per-request verification (continuous authentication)"
        
      ztna_architecture:
        
        components:
          connector: "Lightweight agent on user device"
          gateway: "Cloud service authenticating and authorizing requests"
          application_connector: "Proxy in front of application, validates gateway token"
          
        flow:
          step_1: "User's connector authenticates to gateway (identity, device, context)"
          step_2: "User requests access to application"
          step_3: "Gateway evaluates policy, grants time-limited token"
          step_4: "Connector establishes encrypted tunnel to application connector"
          step_5: "Application connector validates token, proxies connection"
          step_6: "User accesses application, no network-level access"
          
        advantages:
          - "Per-application access control"
          - "No lateral movement (cannot reach other apps)"
          - "Scales better (no centralized VPN concentrator)"
          - "Better user experience (no connect/disconnect)"
          
      ztna_vendors:
        - "Zscaler Private Access"
        - "Cloudflare Access"
        - "Palo Alto Prisma Access"
        - "Cisco Secure Access (formerly Duo Network Gateway)"

  identity_federation:
    
    audience: "Level 2+ organizations integrating multiple identity systems"
    
    overview: |
      Identity federation enables users to authenticate once and access resources 
      across organizational boundaries. B2B collaboration, mergers and acquisitions, 
      and multi-cloud environments require federation to avoid duplicate accounts 
      and manage external identities. This section addresses federation protocols, 
      trust relationships, and cross-organization identity management.
      
    federation_use_cases:
      
      b2b_collaboration:
        scenario: "Partner employees need access to your applications"
        traditional_approach: "Create guest accounts in your directory, manage lifecycle manually"
        federated_approach: "Partner users authenticate with their own identity provider, federated to your resources"
        benefits:
          - "No duplicate accounts to manage"
          - "Partner manages their user lifecycle"
          - "Automatic deprovisioning when partner employee leaves"
          
      merger_acquisition:
        scenario: "Acquired company has separate identity infrastructure"
        challenge: "Two directories, need unified access"
        federation_approach:
          - "Establish trust between identity providers"
          - "Users authenticate with their original IDP"
          - "Access resources across both organizations"
          - "Gradual migration to consolidated identity"
          
      multi_cloud_identity:
        scenario: "Resources in AWS, Azure, GCP with separate identity systems"
        challenge: "Users need access across all clouds"
        federation_approach:
          - "Corporate IDP as source of truth"
          - "Federate to AWS (SAML, OIDC)"
          - "Federate to Azure (Azure AD Connect, federation)"
          - "Federate to GCP (Google Cloud Identity federation)"
          - "Single identity, multiple cloud access"
          
    federation_protocols:
      
      saml_federation:
        
        trust_establishment:
          step_1: "Exchange metadata between identity providers"
          step_2: "Configure trust (certificate validation, attribute mapping)"
          step_3: "Test authentication flow"
          
        authentication_flow:
          step_1: "User accesses resource at Service Provider (SP)"
          step_2: "SP redirects to user's Identity Provider (IDP)"
          step_3: "User authenticates at their IDP"
          step_4: "IDP returns SAML assertion with user attributes"
          step_5: "SP validates assertion and grants access"
          
        attribute_mapping:
          problem: "Different organizations use different attribute names"
          solution: "Map attributes during federation"
          example:
            source_idp: "employeeID"
            target_sp: "user_id"
            mapping: "employeeID → user_id"
            
      oidc_federation:
        
        trust_establishment:
          - "Register client application with identity provider"
          - "Receive client ID and client secret"
          - "Configure redirect URIs"
          
        authentication_flow:
          step_1: "Application redirects user to identity provider"
          step_2: "User authenticates"
          step_3: "IDP redirects back with authorization code"
          step_4: "Application exchanges code for ID token and access token"
          step_5: "Application validates ID token, grants access"
          
        token_types:
          id_token: "JWT containing user identity and attributes"
          access_token: "Bearer token for API access"
          refresh_token: "Long-lived token to obtain new access tokens"
          
      federation_trust_models:
        
        hub_and_spoke:
          structure: "Central IDP federates to multiple service providers"
          example: "Corporate Azure AD federates to AWS, GCP, SaaS apps"
          pros:
            - "Central identity management"
            - "Consistent policies"
          cons:
            - "Single point of failure"
            - "Central IDP must support all required protocols"
            
        mesh:
          structure: "Multiple IDPs trust each other directly"
          example: "Company A IDP ← trust → Company B IDP"
          pros:
            - "No central dependency"
            - "Each org maintains autonomy"
          cons:
            - "Complex trust relationships at scale"
            - "Difficult to manage many-to-many trusts"
            
        broker:
          structure: "Federation broker intermediates between IDPs"
          example: "Company IDPs → Federation broker → Service providers"
          pros:
            - "Abstracts complexity"
            - "Protocol translation (SAML ↔ OIDC)"
            - "Centralized policy enforcement"
          cons:
            - "Additional infrastructure"
            - "Broker becomes critical path"
            
    guest_user_management:
      
      guest_account_lifecycle:
        
        invitation:
          step_1: "Internal user invites external partner"
          step_2: "System sends invitation email to partner"
          step_3: "Partner accepts invitation"
          step_4: "Guest account created (federated or local)"
          
        access_provisioning:
          - "Grant least privilege access"
          - "Time-bound access (30-90 days typical)"
          - "Require MFA for guest access"
          - "Limit to specific resources (no broad network access)"
          
        access_review:
          frequency: "Quarterly review of guest accounts"
          process:
            - "System notifies internal sponsor"
            - "Sponsor attests guest still needs access"
            - "Accounts without attestation automatically disabled"
            
        deprovisioning:
          triggers:
            - "Access expiration reached"
            - "Sponsor revokes access"
            - "Partner relationship ends"
          action: "Disable account, revoke all access immediately"
          
      guest_access_restrictions:
        
        resource_limitations:
          - "Access to shared resources only (not internal systems)"
          - "Cannot invite additional guests (prevent lateral expansion)"
          - "Cannot access user directory (privacy protection)"
          
        authentication_requirements:
          - "MFA required for all guest access"
          - "Conditional access policies (managed device preferred)"
          - "More frequent re-authentication (every 2 hours vs 8 hours for employees)"
          
        monitoring:
          - "Enhanced logging for guest activity"
          - "Alerts on unusual guest behavior"
          - "Guest access analytics dashboard"
          
  identity_lifecycle_management:
    
    audience: "Level 2+ organizations automating identity processes"
    
    overview: |
      Identity lifecycle management automates user provisioning, modification, and 
      deprovisioning across organizational systems. Manual processes create security 
      gaps and operational inefficiency. This section addresses automation strategies, 
      provisioning protocols, and lifecycle orchestration.
      
    joiner_mover_leaver:
      
      joiner_new_hire:
        
        trigger: "HR system creates employee record"
        
        automated_actions:
          identity_creation:
            - "Create user account in directory (AD, Azure AD)"
            - "Generate username following naming convention"
            - "Assign employee ID as unique identifier"
            - "Set default password (force change on first login)"
            
          group_assignment:
            - "Add to department group (based on HR department field)"
            - "Add to location group (based on office location)"
            - "Add to employment type group (FTE, contractor, intern)"
            
          resource_provisioning:
            - "Create email account"
            - "Provision collaboration tools (Slack, Teams)"
            - "Grant access to standard applications (SSO)"
            - "Create home directory or file share"
            
          onboarding_workflow:
            - "Send welcome email with account details"
            - "Trigger hardware provisioning ticket"
            - "Assign onboarding tasks (training, policy acceptance)"
            - "Notify manager and IT"
            
        timing: "Complete within 4 hours of HR record creation"
        
      mover_role_change:
        
        trigger: "HR system updates job title, department, or manager"
        
        automated_actions:
          group_membership_update:
            - "Remove from old department groups"
            - "Add to new department groups"
            - "Update manager relationships"
            
          access_adjustment:
            - "Provision access for new role"
            - "Flag old permissions for review (don't auto-remove)"
            - "Trigger access review workflow for manager"
            
          notification:
            - "Notify old manager (reassign owned resources)"
            - "Notify new manager (review access)"
            - "Notify user (acknowledge role change)"
            
        timing: "Initiate within 24 hours of HR change"
        
      leaver_termination:
        
        trigger: "HR system sets termination date or disables employee"
        
        automated_actions:
          immediate_actions:
            - "Disable user account (within 15 minutes)"
            - "Revoke authentication sessions (force logout)"
            - "Reset password (prevent re-authentication)"
            - "Remove from all distribution lists"
            - "Disable email forwarding"
            
          access_revocation:
            - "Remove all group memberships"
            - "Revoke SSO access to all applications"
            - "Disable API keys and tokens"
            - "Remove VPN access"
            
          data_management:
            - "Convert mailbox to shared mailbox (manager access)"
            - "Backup user files"
            - "Transfer owned resources to manager"
            - "Remove from collaboration tools"
            
          hardware_recovery:
            - "Create ticket for device return"
            - "Remote wipe mobile devices"
            - "Disable hardware tokens"
            
          account_deletion:
            - "Soft delete after 30 days (retention period)"
            - "Hard delete after regulatory retention period (typically 7 years)"
            
        timing: "Critical - execute within 15 minutes of termination event"
        
    provisioning_protocols:
      
      scim:
        name: "System for Cross-domain Identity Management"
        
        purpose: "Standard protocol for automated user provisioning"
        
        operations:
          create_user: "POST /Users"
          read_user: "GET /Users/{id}"
          update_user: "PUT /Users/{id} or PATCH /Users/{id}"
          delete_user: "DELETE /Users/{id}"
          search_users: "GET /Users?filter=..."
          
        benefits:
          - "Vendor-neutral standard"
          - "Supported by major SaaS applications"
          - "Real-time provisioning"
          - "Bi-directional sync possible"
          
        implementation:
          - "Identity provider acts as SCIM client"
          - "Applications implement SCIM server API"
          - "IDP pushes user changes to applications"
          - "Applications provision users automatically"
          
      ldap_sync:
        
        method: "Periodic synchronization from directory to applications"
        
        flow:
          - "Application periodically queries LDAP directory"
          - "Application compares current users with directory"
          - "Application creates/updates/deletes users to match directory"
          
        limitations:
          - "Batch process (not real-time)"
          - "One-way sync (directory → application)"
          - "Requires application LDAP integration"
          
      api_based_provisioning:
        
        method: "Custom integration using application APIs"
        
        approach:
          - "Identity platform calls application APIs"
          - "Create/update/delete users via API"
          - "Custom attribute mapping"
          
        use_cases:
          - "Applications without SCIM support"
          - "Complex provisioning logic"
          - "Legacy systems with proprietary APIs"
          
        challenges:
          - "Requires development and maintenance"
          - "API changes can break integration"
          - "Rate limiting considerations"
          
    provisioning_architecture:
      
      identity_governance_platform:
        
        purpose: "Orchestrate provisioning across all applications"
        
        capabilities:
          workflow_engine:
            - "Define provisioning workflows"
            - "Approval processes"
            - "Exception handling"
            
          connector_library:
            - "Pre-built integrations to common applications"
            - "SCIM, LDAP, API connectors"
            - "Custom connector development"
            
          reconciliation:
            - "Compare actual access with intended access"
            - "Identify orphaned accounts"
            - "Detect unauthorized changes"
            
          reporting_analytics:
            - "Provisioning success rates"
            - "Time to provision"
            - "Access analytics"
            - "Compliance reporting"
            
        vendors:
          - "SailPoint IdentityIQ"
          - "Okta Identity Governance"
          - "Microsoft Identity Manager"
          - "Saviynt"
          
      provisioning_challenges:
        
        application_sprawl:
          problem: "Hundreds of applications, varying integration maturity"
          mitigation:
            - "Prioritize by user count and criticality"
            - "Retire redundant applications"
            - "Consolidate overlapping tools"
            
        attribute_mapping:
          problem: "Different applications require different attributes"
          mitigation:
            - "Maintain attribute mapping dictionary"
            - "Use transformation rules"
            - "Validate mappings before deployment"
            
        timing_dependencies:
          problem: "Application B requires account in Application A first"
          mitigation:
            - "Define provisioning order"
            - "Implement dependency checks"
            - "Retry logic for failures"
            
        partial_failures:
          problem: "Provisioning succeeds in 5 apps, fails in 1"
          mitigation:
            - "Rollback or compensating actions"
            - "Alert on partial failures"
            - "Manual remediation queue"
            
  identity_threat_detection:
    
    audience: "All levels - integrate with Chapter 2.4 Detection Engineering"
    
    overview: |
      Identity threat detection identifies compromised credentials, privilege abuse, 
      and anomalous identity behavior. This section bridges IAM implementation with 
      security monitoring, providing identity-specific detection use cases that 
      complement Chapter 2.4's detection engineering framework.
      
    identity_attack_patterns:
      
      credential_compromise:
        
        password_spraying:
          technique: "Attempt common passwords against many accounts"
          detection:
            - "Multiple failed authentications across many users from single source"
            - "Pattern: Few attempts per user (avoid lockout), many users targeted"
          logic: "Source IP with >5 users AND >3 failures per user in 1 hour"
          
        credential_stuffing:
          technique: "Use stolen credentials from breaches against your systems"
          detection:
            - "Successful authentications from known malicious IPs"
            - "Multiple failed authentications followed by success"
            - "Unusual authentication patterns (time, location)"
          logic: "Authentication from IP in threat intel feeds OR successful auth after >5 failures"
          
        phishing_credential_theft:
          technique: "User enters credentials on fake login page"
          detection:
            - "Impossible travel (login from two locations <4 hours)"
            - "Authentication immediately after MFA push denial"
            - "Login from unusual user agent or device"
          logic: "Successful auth from new device AND new location within 1 hour of MFA denial"
          
      privilege_abuse:
        
        privilege_escalation:
          technique: "User gains higher privileges than authorized"
          detection:
            - "User added to administrative groups"
            - "Permission grants outside approval workflow"
            - "Service account elevated to admin"
          logic: "User role change to admin AND no approval workflow record"
          
        lateral_movement:
          technique: "Attacker moves from compromised account to other systems"
          detection:
            - "Account accessing unusual systems"
            - "Service account used interactively"
            - "Account accessing systems outside department"
          logic: "User authentication to system never accessed before AND system criticality = high"
          
        data_exfiltration:
          technique: "Bulk data access and download"
          detection:
            - "Unusual volume of data access"
            - "Bulk downloads or API calls"
            - "Access to data outside normal scope"
          logic: "User data access volume >3σ above baseline in 1 hour"
          
      insider_threats:
        
        malicious_insider:
          behaviors:
            - "After-hours access to sensitive data"
            - "Attempts to bypass security controls"
            - "Accessing data unrelated to job function"
            - "Large downloads before resignation"
          detection:
            - "Behavioral analytics (deviation from normal)"
            - "Access to unusual resources"
            - "Combination of indicators (access + download + time)"
            
        negligent_insider:
          behaviors:
            - "Sharing credentials"
            - "Clicking phishing links"
            - "Misconfiguring security settings"
          detection:
            - "Multiple authentications from different locations simultaneously"
            - "Authentication after reported phishing email"
            - "Security policy changes by non-admin"
            
    identity_detection_rules:
      
      authentication_anomalies:
        
        impossible_travel:
          logic: "Successful authentication from Location A, followed by authentication from Location B where distance/time > possible travel"
          data_sources: "Authentication logs, geolocation data"
          false_positives: "VPN, cloud services with multiple endpoints"
          tuning: "Whitelist known VPN endpoints, cloud service IPs"
          
        new_device_authentication:
          logic: "Successful authentication from device not seen in past 90 days"
          data_sources: "Authentication logs, device fingerprinting"
          false_positives: "Legitimate new device"
          tuning: "Require MFA for new devices (detection becomes verification)"
          
        after_hours_privileged_access:
          logic: "Administrative authentication outside business hours (defined per user)"
          data_sources: "Authentication logs, HR data (work hours)"
          false_positives: "On-call rotations, legitimate maintenance"
          tuning: "Whitelist approved maintenance windows, on-call staff"
          
      authorization_anomalies:
        
        access_to_sensitive_data:
          logic: "User accesses data classified as sensitive when user never accessed before"
          data_sources: "Authorization logs, data classification"
          false_positives: "Legitimate job function change"
          tuning: "Require approval for first-time sensitive data access"
          
        excessive_permissions_usage:
          logic: "User exercises permissions far beyond normal usage"
          data_sources: "Authorization logs, user behavior baseline"
          false_positives: "Quarterly reporting, audit activities"
          tuning: "Whitelist known batch processes, reporting periods"
          
      identity_lifecycle_anomalies:
        
        dormant_account_reactivation:
          logic: "Account inactive >90 days suddenly authenticates"
          data_sources: "Authentication logs, last activity timestamps"
          false_positives: "Seasonal workers, contractors returning"
          tuning: "Disable accounts after inactivity, require re-enablement process"
          
        rapid_permission_grants:
          logic: "User granted >5 new permissions in <1 hour"
          data_sources: "Permission change logs"
          false_positives: "Legitimate role change, new hire onboarding"
          tuning: "Require approval workflow, whitelist automated provisioning"
          
        account_created_and_used_rapidly:
          logic: "New account created and authenticates within 1 hour"
          data_sources: "Account creation logs, authentication logs"
          false_positives: "Automated provisioning for new hires"
          tuning: "Whitelist HR-triggered provisioning, alert on manual account creation"
          
    identity_threat_response:
      
      automated_response_actions:
        
        low_confidence_detections:
          action: "Alert SOC analyst for investigation"
          example: "New device authentication from known location"
          
        medium_confidence_detections:
          action: "Require MFA re-authentication"
          example: "After-hours access to sensitive data"
          
        high_confidence_detections:
          action: "Revoke session, disable account, alert security"
          example: "Impossible travel detected"
          
      investigation_playbooks:
        
        compromised_credential_investigation:
          steps:
            step_1: "Identify all sessions for affected user"
            step_2: "Review authentication logs for 24 hours prior"
            step_3: "Check for unusual access or data downloads"
            step_4: "Force password reset and MFA re-enrollment"
            step_5: "Review account for unauthorized changes"
            step_6: "Notify user and manager"
            
        privilege_escalation_investigation:
          steps:
            step_1: "Identify who granted privileges (approval audit trail)"
            step_2: "Review actions taken with elevated privileges"
            step_3: "Assess impact (data accessed, changes made)"
            step_4: "Revoke excessive privileges"
            step_5: "Determine if privilege grant was authorized"
            step_6: "Escalate to incident response if unauthorized"
            
    integration_with_detection_engineering:
      
      cross_reference: "See Chapter 2.4 Detection Engineering for comprehensive detection framework"
      
      identity_detection_in_siem:
        - "Forward all identity logs to SIEM (authentication, authorization, permission changes)"
        - "Implement identity detection rules in SIEM"
        - "Correlate identity events with endpoint and network detections"
        - "Enrich alerts with user context (department, role, manager)"
        
      identity_threat_hunting:
        - "Hunt for anomalous identity patterns not covered by rules"
        - "Analyze privileged account usage"
        - "Investigate outliers in access patterns"
        - "Correlate with threat intelligence on identity-focused attacks"
        
      metrics:
        - "Mean time to detect identity compromise: Target <4 hours"
        - "Identity-based detection rule coverage: >20 rules"
        - "False positive rate for identity detections: Target <20%"
        - "Percentage of compromised credentials detected before impact: Target >80%"

references:
  mitre_attack_identity_tactics:
    - "TA0006: Credential Access"
    - "TA0004: Privilege Escalation"
    - "TA0003: Persistence (via identity)"
    
  industry_standards:
    - "NIST SP 800-63: Digital Identity Guidelines"
    - "NIST SP 800-162: Attribute Based Access Control"
    - "ISO 27001: Identity and Access Management controls"
    - "CIS Controls: Identity and Access Management"
    
  protocols_and_standards:
    - "SAML 2.0: Security Assertion Markup Language"
    - "OpenID Connect: Identity layer on OAuth 2.0"
    - "OAuth 2.0: Authorization framework"
    - "SCIM 2.0: System for Cross-domain Identity Management"
    - "FIDO2/WebAuthn: Passwordless authentication"
    
cross_references:
  manual_chapters:
    - chapter: "2.1"
      title: "Zero Trust Architecture"
      relevance: "Zero trust network architecture complements zero trust identity"
    - chapter: "2.4"
      title: "Detection Engineering"
      relevance: "Identity threat detection integrates with detection program"
    - chapter: "4.1"
      title: "Security Automation"
      relevance: "Automated identity lifecycle and response"
    - chapter: "4.3"
      title: "Incident Response"
      relevance: "Responding to identity compromise incidents"
      
  vault_repositories:
    - repo: "vault-identity-access"
      description: "IAM policies, configurations, and automation scripts"
      relevance: "Implementation examples for this chapter"
    - repo: "vault-detection-response"
      description: "Identity threat detection rules"
      relevance: "SIEM rules for identity monitoring"
